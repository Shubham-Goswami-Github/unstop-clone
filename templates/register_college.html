{% load static %}
{% block content %}
  {% include "navbar.html" %}

<!-- Bootstrap & Icons -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

<style>
  .form-container {
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: #f4f6f9;
    font-family: 'Segoe UI', sans-serif;
  }

  .form-section {
    background-color: #fff;
    padding: 30px;
    border-radius: 15px;
    width: 100%;
    max-width: 900px;
    box-shadow: 0px 0px 20px rgba(0,0,0,0.1);
    display: flex;
    gap: 30px;
  }

  .form-left {
    flex: 1;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .form-left img {
    max-width: 100%;
    height: auto;
    border-radius: 12px;
    object-fit: contain;
  }

  .form-right {
    flex: 1.2;
  }

  .btn-darkblue {
    background-color: #003366;
    color: white;
  }

  .btn-darkblue:hover {
    background-color: #001d3d;
  }

  .logo-heading-container {
    margin-bottom: 30px;
  }

  .logo-heading-container img {
    height: 38px;
    display: block;
    margin-bottom: 8px;
  }

  .logo-heading-container h4 {
    font-weight: 700;
    color: #003366;
    font-size: 24px;
    margin: 0;
  }

  .form-label {
    font-weight: 600;
    color: #333;
  }

  .back-btn {
    color: #003366;
    text-decoration: none;
    font-weight: 600;
    margin-bottom: 20px;
    display: inline-block;
  }

  .tag-badge {
    background-color: #003366;
    color: white;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 14px;
    display: inline-flex;
    align-items: center;
    gap: 8px;
  }

  .tag-badge i {
    cursor: pointer;
  }

</style>

<div class="form-container">
  <div class="form-section">
    <div class="form-left">
      <img src="{% static 'images/j1.webp' %}" alt="College Image">
    </div>
    <div class="form-right">
      <div class="d-flex justify-content-between align-items-start mb-3">
        <a href="javascript:history.back()" class="btn btn-outline-secondary">
          <i class="fas fa-arrow-left me-1"></i>Back
        </a>
        <img src="{% static 'images/unstop-logo.svg' %}" alt="Unstop Logo" style="height: 45px;">
      </div>

      <div class="text-center mb-4">
        <h3>Add College</h3>
      </div>

     <form method="post" onsubmit="return handleSubmit(event)">

        {% csrf_token %}
        <div class="row mb-3">
          <div class="col-md-6">
            <label class="form-label">College Name</label>
            <input type="text" name="name" class="form-control" required>
          </div>
          <div class="col-md-6">
            <label class="form-label">City</label>
            <input type="text" name="city" class="form-control" required>
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label">Address</label>
          <input type="text" name="address" class="form-control" required>
        </div>

        <div class="row mb-3">
          <div class="col-md-6">
            <label class="form-label">Contact Number</label>
            <input type="number" name="contact_number" class="form-control" required>
          </div>
          <div class="col-md-6">
            <label class="form-label">Email</label>
            <input type="email" name="email" class="form-control" required>
          </div>
        </div>

        <div class="mb-3">
          <label class="form-label">Password</label>
          <input type="password" name="password" class="form-control" required>
        </div>

        <!-- ✅ FIXED -->
       <div class="row mb-3">
  <div class="col-md-6">
    <label class="form-label">Domains Accepted</label>
    <div class="input-group mb-2">
      <input type="text" id="domainsAcceptedInput" class="form-control" placeholder="Add Domain" >
      <button type="button" class="btn btn-outline-secondary" onclick="addDomain()">Add</button>
    </div>
    <div id="domainsTags" class="d-flex flex-wrap gap-2 mb-2"></div>
    <input type="hidden" name="domains_accepted" id="domainsJson">
  </div>

  <div class="col-md-6">
    <label class="form-label">Courses Accepted</label>
    <div class="input-group mb-2">
      <input type="text" id="coursesAcceptedInput" class="form-control" placeholder="Add Course" >
      <button type="button" class="btn btn-outline-secondary" onclick="addCourse()">Add</button>
    </div>
    <div id="coursesTags" class="d-flex flex-wrap gap-2 mb-2"></div>
    <input type="hidden" name="courses_accepted" id="coursesJson">
  </div>
</div>


        <div class="form-check mb-3">
          <input type="checkbox" class="form-check-input" name="is_approved" id="approvedCheck">
          <label class="form-check-label" for="approvedCheck">Approve</label>
        </div>

        <div class="d-flex gap-3">
          <button type="submit" class="btn btn-darkblue">Add College</button>
          <button type="reset" class="btn btn-outline-secondary">Reset</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
 document.addEventListener("DOMContentLoaded", function () {
  const form = document.querySelector("form");

  form.addEventListener("submit", function (event) {
    event.preventDefault();  // Stop normal submission

    // Get values
    const rawDomains = document.getElementById("domainsAccepted").value;
    const rawCourses = document.getElementById("coursesAccepted").value;

    const domainsArray = rawDomains.split(",").map(s => s.trim()).filter(Boolean);
    const coursesArray = rawCourses.split(",").map(s => s.trim()).filter(Boolean);

    // Set hidden field values
    document.getElementById("domainsJson").value = JSON.stringify(domainsArray);
    document.getElementById("coursesJson").value = JSON.stringify(coursesArray);

    // ✅ Delay submit to ensure DOM update
    setTimeout(() => {
      form.submit();
    }, 50);  // Small delay (50ms) ensures fields update
  });
});

</script>
<script>
  function handleSubmit(event) {
    event.preventDefault(); // stop default form submission

    // Get raw values
    const rawDomains = document.getElementById("domainsAccepted").value;
    const rawCourses = document.getElementById("coursesAccepted").value;

    // Parse into array
    const domainsArray = rawDomains.split(',').map(item => item.trim()).filter(Boolean);
    const coursesArray = rawCourses.split(',').map(item => item.trim()).filter(Boolean);

    // Set values in hidden fields
    document.getElementById("domainsJson").value = JSON.stringify(domainsArray);
    document.getElementById("coursesJson").value = JSON.stringify(coursesArray);

    // ✅ Submit the form AFTER setting values
    setTimeout(() => {
      event.target.submit();
    }, 0); // zero delay but ensures value update first

    return false; // to prevent default submission
  }
</script>

<script>
  let domains = [];
  let courses = [];

  function updateHiddenFields() {
    document.getElementById("domainsJson").value = JSON.stringify(domains);
    document.getElementById("coursesJson").value = JSON.stringify(courses);
  }

  function renderTags(type) {
    const container = document.getElementById(type === 'domain' ? 'domainsTags' : 'coursesTags');
    const items = type === 'domain' ? domains : courses;

    container.innerHTML = '';
    items.forEach((item, index) => {
      const tag = document.createElement('span');
      tag.className = 'tag-badge';
      tag.innerHTML = `${item} <i class="fas fa-times" onclick="removeTag('${type}', ${index})"></i>`;
      container.appendChild(tag);
    });

    updateHiddenFields();
  }

  function addDomain() {
    const input = document.getElementById('domainsAcceptedInput');
    const value = input.value.trim();
    if (value && !domains.includes(value)) {
      domains.push(value);
      input.value = '';
      renderTags('domain');
    }
  }

  function addCourse() {
    const input = document.getElementById('coursesAcceptedInput');
    const value = input.value.trim();
    if (value && !courses.includes(value)) {
      courses.push(value);
      input.value = '';
      renderTags('course');
    }
  }

  function removeTag(type, index) {
    if (type === 'domain') {
      domains.splice(index, 1);
      renderTags('domain');
    } else {
      courses.splice(index, 1);
      renderTags('course');
    }
  }

  // Populate hidden fields before form submit (already used in handleSubmit)
  function handleSubmit(event) {
    event.preventDefault();
    updateHiddenFields();
    setTimeout(() => {
      event.target.submit();
    }, 0);
    return false;
  }
</script>


{% endblock %}
