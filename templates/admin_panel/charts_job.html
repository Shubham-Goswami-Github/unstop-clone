{% load static %}


<!-- ✅ Inject Job Data as Safe JSON -->
{{ jobs|json_script:"jobData" }}
{{ jobs_by_day|json_script:"jobsPerDayData" }}

<style>
.dashboard-graph-section {
  display: flex;
  flex-wrap: wrap;
  gap: 24px;
  justify-content: center;
  padding: 0 10px 40px;
}

.graph-card {
  flex: 1 1 calc(50% - 20px);
  background-color: white;
  border-radius: 16px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
  padding: 16px;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  transition: transform 0.3s ease;
}

.graph-card:hover {
  transform: translateY(-4px);
}

.graph-card h5 {
  font-size: 16px;
  margin-bottom: 12px;
  color: #003366;
  text-align: center;
}

.full-width-card {
  width: 100%;
  max-width: 100%;
  min-height: 320px;
}

.full-width-card canvas {
  max-height: 280px;
}

canvas {
  width: 100% !important;
  height: auto !important;
  max-height: 220px;
}

@media screen and (max-width: 768px) {
  .graph-card {
    flex: 1 1 100%;
    max-width: 100%;
  }

  .dashboard-graph-section {
    flex-direction: column;
    gap: 20px;
  }

  .graph-card canvas {
    max-height: 250px;
  }
}
</style>
<!-- ✅ Job Analytics Section Container -->


<div class="row">
  <!-- Line Chart: Jobs Created Per Day -->
  <div class="col-md-8 mb-4">
    <div class="card shadow">
      <div class="card-header bg-white fw-bold">
        <i class="fas fa-chart-line me-2 text-primary"></i>Jobs Created Per Day
      </div>
      <div class="card-body">
        <canvas id="jobsPerDayChart" height="100"></canvas>
      </div>
    </div>
  </div>

  <!-- Pie Chart: Category Breakdown -->
  <div class="col-md-4 mb-4">
    <div class="card shadow">
      <div class="card-header bg-white fw-bold">
        <i class="fas fa-chart-pie me-2 text-success"></i>Job Categories
      </div>
      <div class="card-body">
        <canvas id="jobCategoryChart" height="250"></canvas>
      </div>
    </div>
  </div>
</div>

<div class="row">
  <!-- Bar Chart: Employment Type -->
  <div class="col-md-6 mb-4">
    <div class="card shadow">
      <div class="card-header bg-white fw-bold">
        <i class="fas fa-chart-bar me-2 text-warning"></i>Employment Type
      </div>
      <div class="card-body">
        <canvas id="employmentTypeChart" height="250"></canvas>
      </div>
    </div>
  </div>

  <!-- Bar Chart: Experience Level -->
  <div class="col-md-6 mb-4">
    <div class="card shadow">
      <div class="card-header bg-white fw-bold">
        <i class="fas fa-chart-bar me-2 text-danger"></i>Experience Level
      </div>
      <div class="card-body">
        <canvas id="experienceLevelChart" height="250"></canvas>
      </div>
    </div>
  </div>
</div>

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  const jobData = JSON.parse(document.getElementById('jobData').textContent);
  const jobPerDay = JSON.parse(document.getElementById('jobsPerDayData').textContent);

  // ✅ 1. Line Chart – Jobs Created Per Day
  const jobLineCtx = document.getElementById('jobsPerDayChart').getContext('2d');
  const jobsPerDayChart = new Chart(jobLineCtx, {
    type: 'line',
    data: {
      labels: jobPerDay.map(item => item.day),
      datasets: [{
        label: 'Jobs Posted',
        data: jobPerDay.map(item => item.count),
        backgroundColor: 'rgba(54, 162, 235, 0.2)',
        borderColor: '#3498db',
        fill: true,
        tension: 0.3
      }]
    },
    options: {
      responsive: true,
      scales: {
        y: { beginAtZero: true }
      }
    }
  });

  // ✅ 2. Pie Chart – Job Category Distribution
  const categoryCounts = {};
  jobData.forEach(job => {
    const category = job.category || "Unknown";
    categoryCounts[category] = (categoryCounts[category] || 0) + 1;
  });
  const categoryCtx = document.getElementById('jobCategoryChart').getContext('2d');
  const jobCategoryChart = new Chart(categoryCtx, {
    type: 'pie',
    data: {
      labels: Object.keys(categoryCounts),
      datasets: [{
        data: Object.values(categoryCounts),
        backgroundColor: ['#1abc9c', '#3498db', '#9b59b6', '#f1c40f', '#e74c3c'],
      }]
    }
  });

  // ✅ 3. Bar Chart – Employment Type
  const employmentCounts = {};
  jobData.forEach(job => {
    const type = job.employment_type || "N/A";
    employmentCounts[type] = (employmentCounts[type] || 0) + 1;
  });
  const employmentCtx = document.getElementById('employmentTypeChart').getContext('2d');
  const employmentTypeChart = new Chart(employmentCtx, {
    type: 'bar',
    data: {
      labels: Object.keys(employmentCounts),
      datasets: [{
        label: 'Jobs',
        data: Object.values(employmentCounts),
        backgroundColor: '#ff9f43'
      }]
    },
    options: {
      responsive: true,
      scales: {
        y: { beginAtZero: true }
      }
    }
  });

  // ✅ 4. Bar Chart – Experience Level
  const experienceCounts = {};
  jobData.forEach(job => {
    const level = job.experience_level || "Not Specified";
    experienceCounts[level] = (experienceCounts[level] || 0) + 1;
  });
  const expCtx = document.getElementById('experienceLevelChart').getContext('2d');
  const experienceLevelChart = new Chart(expCtx, {
    type: 'bar',
    data: {
      labels: Object.keys(experienceCounts),
      datasets: [{
        label: 'Jobs',
        data: Object.values(experienceCounts),
        backgroundColor: '#e74c3c'
      }]
    },
    options: {
      responsive: true,
      scales: {
        y: { beginAtZero: true }
      }
    }
  });
</script>